#############
Порядок работы с API
#############
API Контур.Реестро представляет собой HTTP сервис доступный по адресу /realty/v1/. 
Ниже представлены основные методы работы с API 

*************
Авторизация
*************

Для работы с методами API необходимо пройти авторизацию, используя метод :doc:`method/auth`
Авторизация осуществляестя с помошью логина и пароля, которые необходимо передать в теле запроса. 
В случае успешной авторизации пользователю возвращается идентификатор сессии, который должен быть представлен в заголовке Authorization при вызове методов API.
Формат заголовка: ``Authorization: auth.sid <sessionId>``.

*************
Создание документооборота
*************


:ref:`Создание документооборота<method/docflows>` инициализирует процесс работы с документооборотом.
 Создание документооборота не отождествляется с его отправкой. 
 После его создания API  Контур.Реестро на основание полученых данных проверяет наличие необходимых :ref:`требований<response/requirements>`  к данному ДО. 
 В случае их отсутствия ДО становится в очередь на отправку, если - определены, то пользователю возвращается детальное описание действий, которые необходимо осуществить для отправки ДО.


*************
Актуализация состояния документооборота
*************

После отправки состояние документооборота может менятся в связи с его обработкой API Контур.Реестро, затем  Росреестром.
Документообороту могут быть присвоены следующие статусы:

    * queued: ожидает отправки
    * sent: отправлен в Росреестр
    * suspended: требуются дополнительные действия 
    * completed: исполнено
    * error: ошибка обработки
    * verified: верификация документооборота

Для получения информации о событиях, по документообороту необходимо периодически: 
:ref:`вычитывать новости<method/news>` или :ref:`запрашивать описание документооборота<method/getdocflows>`. 

===========
Работа с требованиями к документообороту: Подписание
===========

В случае, когда для продолжения обработки запроса, :ref:`требуется выполнить некоторые действия<response/requirements>`, документооборот переходит в состояние ``suspend``.
 После создания документооборота необходимо выполнить требование:
 * :ref:`signature<response/requirements>` -  подписать заявления участниками документооборота. 
 Данное требование возникает до момента отправки ДО в Росреестр.
Это свзязано c необходимостью создания электронной версии заявления на регистрационное действие.
 После подписание необходимо перейти к этапу отправки документооборота.

*************
Отправка документооборота
*************

После подписания заявлений участников документооборота, необходимо инициировать отправку запроса в Росреестр.
При получении запроса на отправку, он помещается в очередь проверки количества приложенных подписей для каждого документа и их верификации. В случае если подписей недостаточно, либо они не корректны, то будет сгенерировано событие, содержащее описание соответствующей ошибки.

*************
Работа с требованиями к документообороту: Оплата пошлины
*************

После успешной отправки документооборота запрос поступает в обработку системой Росреестра.
До инициализации обработки заявки сотрудником Росреестра, для заявки начисляются :ref:`гос пошлины<response/payment>`. 
Государственная пошлина начисляется за каждое регистрационное действие, которое предусматривает оплату, каждому участнику документооборота инивидуально, учитывая льготы.

В случае, необходимости оплаты гос. пошлины, документооборот переходит в состояние ``suspend`` и  формируется :ref:`событие payment<response/payment>`, содержащее УИН и сумму для оплаты.

Для продолжения работы с заявкой - необходимо оплатить все начисленные гос. пошлины для данной заявки. 
Информация об оплате государственной пошлины поступает в Росреестр автоматически в течении суток с момента оплаты.

*************
Работа с требованиями к документообороту: Оплата пошлины
*************

После отправки документооборота и при необходимости выполнения требований об оплате, необходимо продолжить процессе актуализации документооборота до получения статуса ``completed``.
Если документооборот в состоянии ``completed``, то ответ будет содержать :ref:`результат обработки<response/result>`.

Чтобы получить результирующие документны, необходимо :ref:` запросить содержимое каждого полученного файла<response/result>`.

Для каждого типа запроса, результата будет содержать свой набор файлов. 




